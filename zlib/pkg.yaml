name: zlib
dependencies:
  - stage: base
steps:
  - sources:
      - url: https://zlib.net/fossils/zlib-1.2.11.tar.gz
        destination: zlib.tar.gz
        sha256: c3e5e9fdd5004dcb542feda5ee4f0ff0744628baf8ed2dd5d66f8ca1197cb1a1
        sha512: 73fd3fff4adeccd4894084c15ddac89890cd10ef105dd5e1835e1e9bbb6a49ff229713bd197d203edfa17c2727700fce65a2a235f07568212d820dca88b528ae
    prepare:
      - |
        tar -xf zlib.tar.gz --strip-components=1
        mkdir build
        cd build

        ../configure \
            --prefix=${TOOLCHAIN}
    build:
      - |
        cd build
        make -j $(nproc)
    install:
      - |
        cd build
        make DESTDIR=/rootfs install
finalize:
  - from: /rootfs
    to: /
